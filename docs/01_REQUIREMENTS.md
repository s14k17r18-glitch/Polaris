# 01 要件定義（Windows + iOS / 同機能 / 全共有）

## 目的
DanGi の「談議（DanGi）」体験を、Windows（PC）と iOS（モバイル）で **同一機能**として提供し、
persona（全て）および談議後データ（全て）を **端末間で共有**できる状態にする。

## 固定条件（CONCEPT由来）
- 完全日本語UI/対話
- Personaとユーザーが同一テーマを多面的に討論
- セッションは儀式（Ritual→Council→Ending）として演出される
- 談議ルール：誹謗中傷禁止、押し付け禁止、脱線修正、改善しなければ退席

---

## MUST（MVPで必須）※「1セッション完走」＋「同期で共有」
### A. 機能（セッション完走）
- テーマ入力（お題提示）
- Persona選択（最大7名）＋司会（天の声）1名
- 談議（ターン制でメッセージが進む）
- ルールガード（No Slander / No Dogmatism / Deviation Protocol / Ejection）
- 終了（結論→要約生成→Knowledge Crystal生成）
- セッションログ保存（最低限ローカル）

### B. 共有（persona/談議データ “全て”）
- アカウント/ユーザー識別（ログイン等）※方式は実装で選ぶが必須
- クラウド同期：
  - persona定義（全て）
  - セッション（theme、参加者、席順、ターン、司会介入、退席など）
  - メッセージログ（全て）
  - Knowledge Crystal（全て）
- 同期の競合（2端末同時編集等）に対する基本戦略（後述の Data Model/Sync で定義）

### C. Windows + iOS 機能パリティ（同機能の強制）
- Windows版とiOS版で、MUST機能は **完全一致**していること
- 仕様変更/機能追加の完了条件（DoD）は
  - **Windowsで動く**
  - **iOSで動く**
  - **同期が壊れていない**
  を全て満たすこと

### D. UI/UX（MVP成立）
- 研究室UIの基礎（ダーク基調＋ガラスパネル）
- 吹き出し廃止：ログは「投影された文字列」表現
- PC：マウス/キーボードでも操作できる
- iOS：タップ/スワイプ中心で破綻しない

### E. 品質/運用
- 失敗復帰：API失敗時のリトライ/中断/再開
- 入力データ（persona定義）のバリデーション
- コスト上限（セッションあたりの上限を設定）
- プライバシー：ログはユーザー明示同意なしで外部共有しない

---

## SHOULD（MVP直後）
- Dragで円卓配置（Heptagon Ringの配置UI）
- 発言者フォーカス（Orbit In／クローズアップ）
- 逸脱時の「天の声」介入（自動）
- セッション共有（URL/エクスポート）

---

## LATER（後段）
- Personaの二形態（Avatar/Core）のリッチ演出
- Constellation View（共鳴の可視化）
- Persona生成ウィザード（Digital Forge）
- User Import（著書/論文/ログの取り込み）
- 学習と進化（Knowledge Crystal条件＋共鳴で性格パラメータ変化）
- 本人声質に似せたVoice（※要件として残すがリスクが高い：10_RISKS参照。MVPでは封印）

---

## 非機能要件（初期）
- レスポンス：会話1ターンの生成は体感5秒以内を目標（ストリーミング表示で体感改善）
- 可用性：同期・保存で致命的エラーが出てもログが失われない
- セキュリティ：APIキー/秘密情報はクライアントに埋め込まない
